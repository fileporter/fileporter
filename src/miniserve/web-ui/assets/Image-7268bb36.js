import{u as x,a as b,r as d,b as y,S as j,t as I,n as E,s as f,j as u,c as T}from"./index-56a410a3.js";function S(s){var g,v;const o=x(),[a]=b(),n=d.useRef(),c=y(["meta",s.parent],({signal:e})=>T.getFileMeta({params:{path:s.parent},signal:e}),{staleTime:6e4}),r=d.useMemo(()=>{var e;return((e=c.data)==null?void 0:e.type)!=="directory"?void 0:c.data.contents.filter(t=>{var l;return t.type==="file"&&(((l=t.mime)==null?void 0:l.startsWith("image/"))||t.has_video&&!t.has_audio&&t.duration&&t.duration<=60)}).sort(a===j.alphabetic?I:E)},[c.data]);function i(){return(r==null?void 0:r.findIndex(e=>e.path===s.path))??-1}function h(){const e=i(),t=e<=0||r==null?void 0:r.at(e-1);t&&o(`/~/${t.path}`)}function m(){const e=i(),t=e<0||r==null?void 0:r.at(e+1);t&&o(`/~/${t.path}`)}k(h,m),C(h,m),d.useEffect(()=>{const e=i(),t=e<=0||r==null?void 0:r.at(e-1);if(t){const p=new Image;p.src=f(`/files/${t.path}`)}const l=e<0||r==null?void 0:r.at(e+1);if(l){const p=new Image;p.src=f(`/files/${l.path}`)}},[r]);const w=f(`/files/${s.path}`);return u.jsx("div",{className:"fixed inset-0 w-screen h-screen bg-black",children:s.has_video?u.jsxs(u.Fragment,{children:[u.jsx("video",{className:"w-full h-full",autoPlay:!0,loop:!0,onTimeUpdate:e=>{const t=e.currentTarget;n.current&&(n.current.max=t.duration,n.current.value=t.currentTime)},onDoubleClick:e=>{const t=e.currentTarget;t.paused?t.play():t.pause()},children:u.jsx("source",{src:w,type:s.mime??void 0})}),u.jsx("progress",{className:"fixed inset-x-0 bottom-0 w-full h-1 transition-[width]",ref:e=>n.current=e})]}):u.jsx("img",{className:"object-contain w-full h-full",width:(g=s.size)==null?void 0:g.width,height:(v=s.size)==null?void 0:v.height,src:w,alt:s.basename})})}function k(s,o){d.useEffect(()=>{const a=new AbortController;return window.addEventListener("keydown",n=>{switch(n.key){case"ArrowLeft":s();break;case"ArrowRight":o();break}},{signal:a.signal}),()=>a.abort()},[s,o])}function C(s,o){const a=d.useRef();d.useEffect(()=>{const n=new AbortController;return window.addEventListener("touchstart",c=>{a.current=c.changedTouches[0].screenX},{signal:n.signal}),window.addEventListener("touchend",c=>{const i=c.changedTouches[0].screenX-a.current,h=window.screen.width;Math.abs(i)>h/3&&(i>0?s():o()),a.current=void 0},{signal:n.signal}),()=>n.abort()},[s,o])}export{S as default};
