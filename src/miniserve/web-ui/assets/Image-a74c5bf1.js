import{u as x,a as y,r as c,b as I,S as E,t as j,n as S,s as p,j as d,c as k}from"./index-8609a84a.js";function A(n){var v,b;const o=x(),[r]=y(),[a,u]=c.useState(!0),l=I(["meta",n.parent],({signal:e})=>k.get(`/api/${n.parent}`,{signal:e}).then(s=>s.data),{staleTime:6e4}),t=c.useMemo(()=>{var e;return(e=l.data)==null?void 0:e.contents.filter(s=>{var i;return s.type==="file"&&(((i=s.mime)==null?void 0:i.startsWith("image/"))||s.has_video&&!s.has_audio&&s.duration&&s.duration<=60)}).sort(r===E.alphabetic?j:S)},[l.data]);function h(){return(t==null?void 0:t.findIndex(e=>e.path===n.path))??-1}function w(){const e=h(),s=e<=0||t==null?void 0:t.at(e-1);s&&o(`/~/${s.path}`)}function g(){const e=h(),s=e<0||t==null?void 0:t.at(e+1);s&&o(`/~/${s.path}`)}C(w,g),$(w,g),c.useEffect(()=>{const e=h(),s=e<=0||t==null?void 0:t.at(e-1);if(s){const f=new Image;f.src=p(`/files/${s.path}`)}const i=e<0||t==null?void 0:t.at(e+1);if(i){const f=new Image;f.src=p(`/files/${i.path}`)}},[t]);const m=p(`/files/${n.path}`);return d.jsx("div",{className:a?"fixed inset-0 w-screen h-screen bg-black":"my-auto",children:n.has_video?d.jsx("video",{className:"w-full h-full",autoPlay:!0,loop:!0,children:d.jsx("source",{src:m,type:n.mime})}):d.jsx("img",{className:"object-contain w-full h-full",width:(v=n.size)==null?void 0:v.width,height:(b=n.size)==null?void 0:b.height,src:m,alt:n.basename,onDoubleClick:()=>u(!a)})})}function C(n,o){c.useEffect(()=>{const r=new AbortController;return window.addEventListener("keydown",a=>{switch(a.key){case"ArrowLeft":n();break;case"ArrowRight":o();break}},{signal:r.signal}),()=>r.abort()},[n,o])}function $(n,o){const r=c.useRef();c.useEffect(()=>{const a=new AbortController;return window.addEventListener("touchstart",u=>{r.current=u.changedTouches[0].screenX},{signal:a.signal}),window.addEventListener("touchend",u=>{const t=u.changedTouches[0].screenX-r.current;Math.abs(t)>50&&(t>0?n():o()),r.current=void 0},{signal:a.signal}),()=>a.abort()},[n,o])}export{A as default};
