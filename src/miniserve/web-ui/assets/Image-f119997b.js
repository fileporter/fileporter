import{u as x,a as b,r as d,b as j,S as y,t as I,n as E,s as p,j as c,c as T}from"./index-68309880.js";function $(s){var m,v;const o=x(),[a]=b(),r=d.useRef(),u=j(["meta",s.parent],({signal:t})=>T.get(`/api/${s.parent}`,{signal:t}).then(e=>e.data),{staleTime:6e4}),n=d.useMemo(()=>{var t;return(t=u.data)==null?void 0:t.contents.filter(e=>{var l;return e.type==="file"&&(((l=e.mime)==null?void 0:l.startsWith("image/"))||e.has_video&&!e.has_audio&&e.duration&&e.duration<=60)}).sort(a===y.alphabetic?I:E)},[u.data]);function i(){return(n==null?void 0:n.findIndex(t=>t.path===s.path))??-1}function h(){const t=i(),e=t<=0||n==null?void 0:n.at(t-1);e&&o(`/~/${e.path}`)}function w(){const t=i(),e=t<0||n==null?void 0:n.at(t+1);e&&o(`/~/${e.path}`)}k(h,w),C(h,w),d.useEffect(()=>{const t=i(),e=t<=0||n==null?void 0:n.at(t-1);if(e){const f=new Image;f.src=p(`/files/${e.path}`)}const l=t<0||n==null?void 0:n.at(t+1);if(l){const f=new Image;f.src=p(`/files/${l.path}`)}},[n]);const g=p(`/files/${s.path}`);return c.jsx("div",{className:"fixed inset-0 w-screen h-screen bg-black",children:s.has_video?c.jsxs(c.Fragment,{children:[c.jsx("video",{className:"w-full h-full",autoPlay:!0,loop:!0,onTimeUpdate:t=>{const e=t.currentTarget;r.current&&(r.current.max=e.duration,r.current.value=e.currentTime)},onDoubleClick:t=>{const e=t.currentTarget;e.paused?e.play():e.pause()},children:c.jsx("source",{src:g,type:s.mime})}),c.jsx("progress",{className:"fixed inset-x-0 bottom-0 w-full h-1 transition-[width]",ref:t=>r.current=t})]}):c.jsx("img",{className:"object-contain w-full h-full",width:(m=s.size)==null?void 0:m.width,height:(v=s.size)==null?void 0:v.height,src:g,alt:s.basename})})}function k(s,o){d.useEffect(()=>{const a=new AbortController;return window.addEventListener("keydown",r=>{switch(r.key){case"ArrowLeft":s();break;case"ArrowRight":o();break}},{signal:a.signal}),()=>a.abort()},[s,o])}function C(s,o){const a=d.useRef();d.useEffect(()=>{const r=new AbortController;return window.addEventListener("touchstart",u=>{a.current=u.changedTouches[0].screenX},{signal:r.signal}),window.addEventListener("touchend",u=>{const i=u.changedTouches[0].screenX-a.current,h=window.screen.width;Math.abs(i)>h/3&&(i>0?s():o()),a.current=void 0},{signal:r.signal}),()=>r.abort()},[s,o])}export{$ as default};
